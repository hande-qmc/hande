module bit_table_256_m

    ! 256-bit lookup table.

    implicit none

    ! bit_table_256{0,i) gives the number of bits set in the integer i.
    ! bit_table_256(:,i) gives the list of bits set in integer i, using a 1-based index.
    ! (NOTE: Fortran treats bits as 0-indexed!)
    !
    ! This can be generated in python using:
    !
    !    table = []
    !    for x in range(256):
    !        set_bits = [i+1 for i in range(8) if x >> i & 1]
    !        set_bits.insert(0, len(set_bits))
    !        set_bits += [-1]*(8-len(set_bits)+1)
    !        table.append(','.join([str(s) for s in set_bits]))
    !    print('integer, parameter :: bit_table_256(0:8,0:255) = reshape([ &')
    !    print(', &\n'.join(table) + '], shape(bit_table_256))')

    ! This can be adapted to create a lookup table for 16-bit (or larger!) chunks at the cost
    ! of O(2^16) rather than O(2^8) memory.  Using 8-bit chunks appears to be a good compromise
    ! in terms of memory (incl. cache) and speed.

    integer, parameter :: bit_table_256(0:8,0:255) = reshape([ &
        0,-1,-1,-1,-1,-1,-1,-1,-1, &
        1,1,-1,-1,-1,-1,-1,-1,-1, &
        1,2,-1,-1,-1,-1,-1,-1,-1, &
        2,1,2,-1,-1,-1,-1,-1,-1, &
        1,3,-1,-1,-1,-1,-1,-1,-1, &
        2,1,3,-1,-1,-1,-1,-1,-1, &
        2,2,3,-1,-1,-1,-1,-1,-1, &
        3,1,2,3,-1,-1,-1,-1,-1, &
        1,4,-1,-1,-1,-1,-1,-1,-1, &
        2,1,4,-1,-1,-1,-1,-1,-1, &
        2,2,4,-1,-1,-1,-1,-1,-1, &
        3,1,2,4,-1,-1,-1,-1,-1, &
        2,3,4,-1,-1,-1,-1,-1,-1, &
        3,1,3,4,-1,-1,-1,-1,-1, &
        3,2,3,4,-1,-1,-1,-1,-1, &
        4,1,2,3,4,-1,-1,-1,-1, &
        1,5,-1,-1,-1,-1,-1,-1,-1, &
        2,1,5,-1,-1,-1,-1,-1,-1, &
        2,2,5,-1,-1,-1,-1,-1,-1, &
        3,1,2,5,-1,-1,-1,-1,-1, &
        2,3,5,-1,-1,-1,-1,-1,-1, &
        3,1,3,5,-1,-1,-1,-1,-1, &
        3,2,3,5,-1,-1,-1,-1,-1, &
        4,1,2,3,5,-1,-1,-1,-1, &
        2,4,5,-1,-1,-1,-1,-1,-1, &
        3,1,4,5,-1,-1,-1,-1,-1, &
        3,2,4,5,-1,-1,-1,-1,-1, &
        4,1,2,4,5,-1,-1,-1,-1, &
        3,3,4,5,-1,-1,-1,-1,-1, &
        4,1,3,4,5,-1,-1,-1,-1, &
        4,2,3,4,5,-1,-1,-1,-1, &
        5,1,2,3,4,5,-1,-1,-1, &
        1,6,-1,-1,-1,-1,-1,-1,-1, &
        2,1,6,-1,-1,-1,-1,-1,-1, &
        2,2,6,-1,-1,-1,-1,-1,-1, &
        3,1,2,6,-1,-1,-1,-1,-1, &
        2,3,6,-1,-1,-1,-1,-1,-1, &
        3,1,3,6,-1,-1,-1,-1,-1, &
        3,2,3,6,-1,-1,-1,-1,-1, &
        4,1,2,3,6,-1,-1,-1,-1, &
        2,4,6,-1,-1,-1,-1,-1,-1, &
        3,1,4,6,-1,-1,-1,-1,-1, &
        3,2,4,6,-1,-1,-1,-1,-1, &
        4,1,2,4,6,-1,-1,-1,-1, &
        3,3,4,6,-1,-1,-1,-1,-1, &
        4,1,3,4,6,-1,-1,-1,-1, &
        4,2,3,4,6,-1,-1,-1,-1, &
        5,1,2,3,4,6,-1,-1,-1, &
        2,5,6,-1,-1,-1,-1,-1,-1, &
        3,1,5,6,-1,-1,-1,-1,-1, &
        3,2,5,6,-1,-1,-1,-1,-1, &
        4,1,2,5,6,-1,-1,-1,-1, &
        3,3,5,6,-1,-1,-1,-1,-1, &
        4,1,3,5,6,-1,-1,-1,-1, &
        4,2,3,5,6,-1,-1,-1,-1, &
        5,1,2,3,5,6,-1,-1,-1, &
        3,4,5,6,-1,-1,-1,-1,-1, &
        4,1,4,5,6,-1,-1,-1,-1, &
        4,2,4,5,6,-1,-1,-1,-1, &
        5,1,2,4,5,6,-1,-1,-1, &
        4,3,4,5,6,-1,-1,-1,-1, &
        5,1,3,4,5,6,-1,-1,-1, &
        5,2,3,4,5,6,-1,-1,-1, &
        6,1,2,3,4,5,6,-1,-1, &
        1,7,-1,-1,-1,-1,-1,-1,-1, &
        2,1,7,-1,-1,-1,-1,-1,-1, &
        2,2,7,-1,-1,-1,-1,-1,-1, &
        3,1,2,7,-1,-1,-1,-1,-1, &
        2,3,7,-1,-1,-1,-1,-1,-1, &
        3,1,3,7,-1,-1,-1,-1,-1, &
        3,2,3,7,-1,-1,-1,-1,-1, &
        4,1,2,3,7,-1,-1,-1,-1, &
        2,4,7,-1,-1,-1,-1,-1,-1, &
        3,1,4,7,-1,-1,-1,-1,-1, &
        3,2,4,7,-1,-1,-1,-1,-1, &
        4,1,2,4,7,-1,-1,-1,-1, &
        3,3,4,7,-1,-1,-1,-1,-1, &
        4,1,3,4,7,-1,-1,-1,-1, &
        4,2,3,4,7,-1,-1,-1,-1, &
        5,1,2,3,4,7,-1,-1,-1, &
        2,5,7,-1,-1,-1,-1,-1,-1, &
        3,1,5,7,-1,-1,-1,-1,-1, &
        3,2,5,7,-1,-1,-1,-1,-1, &
        4,1,2,5,7,-1,-1,-1,-1, &
        3,3,5,7,-1,-1,-1,-1,-1, &
        4,1,3,5,7,-1,-1,-1,-1, &
        4,2,3,5,7,-1,-1,-1,-1, &
        5,1,2,3,5,7,-1,-1,-1, &
        3,4,5,7,-1,-1,-1,-1,-1, &
        4,1,4,5,7,-1,-1,-1,-1, &
        4,2,4,5,7,-1,-1,-1,-1, &
        5,1,2,4,5,7,-1,-1,-1, &
        4,3,4,5,7,-1,-1,-1,-1, &
        5,1,3,4,5,7,-1,-1,-1, &
        5,2,3,4,5,7,-1,-1,-1, &
        6,1,2,3,4,5,7,-1,-1, &
        2,6,7,-1,-1,-1,-1,-1,-1, &
        3,1,6,7,-1,-1,-1,-1,-1, &
        3,2,6,7,-1,-1,-1,-1,-1, &
        4,1,2,6,7,-1,-1,-1,-1, &
        3,3,6,7,-1,-1,-1,-1,-1, &
        4,1,3,6,7,-1,-1,-1,-1, &
        4,2,3,6,7,-1,-1,-1,-1, &
        5,1,2,3,6,7,-1,-1,-1, &
        3,4,6,7,-1,-1,-1,-1,-1, &
        4,1,4,6,7,-1,-1,-1,-1, &
        4,2,4,6,7,-1,-1,-1,-1, &
        5,1,2,4,6,7,-1,-1,-1, &
        4,3,4,6,7,-1,-1,-1,-1, &
        5,1,3,4,6,7,-1,-1,-1, &
        5,2,3,4,6,7,-1,-1,-1, &
        6,1,2,3,4,6,7,-1,-1, &
        3,5,6,7,-1,-1,-1,-1,-1, &
        4,1,5,6,7,-1,-1,-1,-1, &
        4,2,5,6,7,-1,-1,-1,-1, &
        5,1,2,5,6,7,-1,-1,-1, &
        4,3,5,6,7,-1,-1,-1,-1, &
        5,1,3,5,6,7,-1,-1,-1, &
        5,2,3,5,6,7,-1,-1,-1, &
        6,1,2,3,5,6,7,-1,-1, &
        4,4,5,6,7,-1,-1,-1,-1, &
        5,1,4,5,6,7,-1,-1,-1, &
        5,2,4,5,6,7,-1,-1,-1, &
        6,1,2,4,5,6,7,-1,-1, &
        5,3,4,5,6,7,-1,-1,-1, &
        6,1,3,4,5,6,7,-1,-1, &
        6,2,3,4,5,6,7,-1,-1, &
        7,1,2,3,4,5,6,7,-1, &
        1,8,-1,-1,-1,-1,-1,-1,-1, &
        2,1,8,-1,-1,-1,-1,-1,-1, &
        2,2,8,-1,-1,-1,-1,-1,-1, &
        3,1,2,8,-1,-1,-1,-1,-1, &
        2,3,8,-1,-1,-1,-1,-1,-1, &
        3,1,3,8,-1,-1,-1,-1,-1, &
        3,2,3,8,-1,-1,-1,-1,-1, &
        4,1,2,3,8,-1,-1,-1,-1, &
        2,4,8,-1,-1,-1,-1,-1,-1, &
        3,1,4,8,-1,-1,-1,-1,-1, &
        3,2,4,8,-1,-1,-1,-1,-1, &
        4,1,2,4,8,-1,-1,-1,-1, &
        3,3,4,8,-1,-1,-1,-1,-1, &
        4,1,3,4,8,-1,-1,-1,-1, &
        4,2,3,4,8,-1,-1,-1,-1, &
        5,1,2,3,4,8,-1,-1,-1, &
        2,5,8,-1,-1,-1,-1,-1,-1, &
        3,1,5,8,-1,-1,-1,-1,-1, &
        3,2,5,8,-1,-1,-1,-1,-1, &
        4,1,2,5,8,-1,-1,-1,-1, &
        3,3,5,8,-1,-1,-1,-1,-1, &
        4,1,3,5,8,-1,-1,-1,-1, &
        4,2,3,5,8,-1,-1,-1,-1, &
        5,1,2,3,5,8,-1,-1,-1, &
        3,4,5,8,-1,-1,-1,-1,-1, &
        4,1,4,5,8,-1,-1,-1,-1, &
        4,2,4,5,8,-1,-1,-1,-1, &
        5,1,2,4,5,8,-1,-1,-1, &
        4,3,4,5,8,-1,-1,-1,-1, &
        5,1,3,4,5,8,-1,-1,-1, &
        5,2,3,4,5,8,-1,-1,-1, &
        6,1,2,3,4,5,8,-1,-1, &
        2,6,8,-1,-1,-1,-1,-1,-1, &
        3,1,6,8,-1,-1,-1,-1,-1, &
        3,2,6,8,-1,-1,-1,-1,-1, &
        4,1,2,6,8,-1,-1,-1,-1, &
        3,3,6,8,-1,-1,-1,-1,-1, &
        4,1,3,6,8,-1,-1,-1,-1, &
        4,2,3,6,8,-1,-1,-1,-1, &
        5,1,2,3,6,8,-1,-1,-1, &
        3,4,6,8,-1,-1,-1,-1,-1, &
        4,1,4,6,8,-1,-1,-1,-1, &
        4,2,4,6,8,-1,-1,-1,-1, &
        5,1,2,4,6,8,-1,-1,-1, &
        4,3,4,6,8,-1,-1,-1,-1, &
        5,1,3,4,6,8,-1,-1,-1, &
        5,2,3,4,6,8,-1,-1,-1, &
        6,1,2,3,4,6,8,-1,-1, &
        3,5,6,8,-1,-1,-1,-1,-1, &
        4,1,5,6,8,-1,-1,-1,-1, &
        4,2,5,6,8,-1,-1,-1,-1, &
        5,1,2,5,6,8,-1,-1,-1, &
        4,3,5,6,8,-1,-1,-1,-1, &
        5,1,3,5,6,8,-1,-1,-1, &
        5,2,3,5,6,8,-1,-1,-1, &
        6,1,2,3,5,6,8,-1,-1, &
        4,4,5,6,8,-1,-1,-1,-1, &
        5,1,4,5,6,8,-1,-1,-1, &
        5,2,4,5,6,8,-1,-1,-1, &
        6,1,2,4,5,6,8,-1,-1, &
        5,3,4,5,6,8,-1,-1,-1, &
        6,1,3,4,5,6,8,-1,-1, &
        6,2,3,4,5,6,8,-1,-1, &
        7,1,2,3,4,5,6,8,-1, &
        2,7,8,-1,-1,-1,-1,-1,-1, &
        3,1,7,8,-1,-1,-1,-1,-1, &
        3,2,7,8,-1,-1,-1,-1,-1, &
        4,1,2,7,8,-1,-1,-1,-1, &
        3,3,7,8,-1,-1,-1,-1,-1, &
        4,1,3,7,8,-1,-1,-1,-1, &
        4,2,3,7,8,-1,-1,-1,-1, &
        5,1,2,3,7,8,-1,-1,-1, &
        3,4,7,8,-1,-1,-1,-1,-1, &
        4,1,4,7,8,-1,-1,-1,-1, &
        4,2,4,7,8,-1,-1,-1,-1, &
        5,1,2,4,7,8,-1,-1,-1, &
        4,3,4,7,8,-1,-1,-1,-1, &
        5,1,3,4,7,8,-1,-1,-1, &
        5,2,3,4,7,8,-1,-1,-1, &
        6,1,2,3,4,7,8,-1,-1, &
        3,5,7,8,-1,-1,-1,-1,-1, &
        4,1,5,7,8,-1,-1,-1,-1, &
        4,2,5,7,8,-1,-1,-1,-1, &
        5,1,2,5,7,8,-1,-1,-1, &
        4,3,5,7,8,-1,-1,-1,-1, &
        5,1,3,5,7,8,-1,-1,-1, &
        5,2,3,5,7,8,-1,-1,-1, &
        6,1,2,3,5,7,8,-1,-1, &
        4,4,5,7,8,-1,-1,-1,-1, &
        5,1,4,5,7,8,-1,-1,-1, &
        5,2,4,5,7,8,-1,-1,-1, &
        6,1,2,4,5,7,8,-1,-1, &
        5,3,4,5,7,8,-1,-1,-1, &
        6,1,3,4,5,7,8,-1,-1, &
        6,2,3,4,5,7,8,-1,-1, &
        7,1,2,3,4,5,7,8,-1, &
        3,6,7,8,-1,-1,-1,-1,-1, &
        4,1,6,7,8,-1,-1,-1,-1, &
        4,2,6,7,8,-1,-1,-1,-1, &
        5,1,2,6,7,8,-1,-1,-1, &
        4,3,6,7,8,-1,-1,-1,-1, &
        5,1,3,6,7,8,-1,-1,-1, &
        5,2,3,6,7,8,-1,-1,-1, &
        6,1,2,3,6,7,8,-1,-1, &
        4,4,6,7,8,-1,-1,-1,-1, &
        5,1,4,6,7,8,-1,-1,-1, &
        5,2,4,6,7,8,-1,-1,-1, &
        6,1,2,4,6,7,8,-1,-1, &
        5,3,4,6,7,8,-1,-1,-1, &
        6,1,3,4,6,7,8,-1,-1, &
        6,2,3,4,6,7,8,-1,-1, &
        7,1,2,3,4,6,7,8,-1, &
        4,5,6,7,8,-1,-1,-1,-1, &
        5,1,5,6,7,8,-1,-1,-1, &
        5,2,5,6,7,8,-1,-1,-1, &
        6,1,2,5,6,7,8,-1,-1, &
        5,3,5,6,7,8,-1,-1,-1, &
        6,1,3,5,6,7,8,-1,-1, &
        6,2,3,5,6,7,8,-1,-1, &
        7,1,2,3,5,6,7,8,-1, &
        5,4,5,6,7,8,-1,-1,-1, &
        6,1,4,5,6,7,8,-1,-1, &
        6,2,4,5,6,7,8,-1,-1, &
        7,1,2,4,5,6,7,8,-1, &
        6,3,4,5,6,7,8,-1,-1, &
        7,1,3,4,5,6,7,8,-1, &
        7,2,3,4,5,6,7,8,-1, &
        8,1,2,3,4,5,6,7,8], shape(bit_table_256))

end module bit_table_256_m
